<!-- =========================
ADMIN PANEL (Static CMS)
Place these files in /admin and /content
========================= -->

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî Vintage Treasures</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
</head>
<body>
  <!-- Netlify Identity -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <!-- Static CMS –ª–æ–∫–∞–ª—å–Ω–æ -->
  <script src="./cms/static-cms-app.js"></script>

  <script>
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –µ—Å–ª–∏ —é–∑–µ—Ä –ø–æ invite_token
    if (window.location.hash.includes('invite_token')) {
      console.log("üîê Invite token detected ‚Äî opening Netlify Identity widget...");
      netlifyIdentity.on('init', user => {
        if (!user) netlifyIdentity.open('signup');
      });
    }

    // –ñ–¥—ë–º, –ø–æ–∫–∞ StaticCmsApp –ø—Ä–æ–≥—Ä—É–∑–∏—Ç—Å—è
    function initCMSWhenReady() {
      if (window.StaticCmsApp && typeof window.StaticCmsApp.init === 'function') {
        console.log('‚úÖ Static CMS –∑–∞–≥—Ä—É–∂–µ–Ω. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
        window.StaticCmsApp.init({
          config: {
            backend: {
              name: 'git-gateway',
              branch: 'main',
            },
            locale: 'ru',
            media_folder: 'assets/uploads',
            public_folder: '/assets/uploads',
            collections: [
              {
                name: 'products',
                label: '–¢–æ–≤–∞—Ä—ã',
                label_singular: '–¢–æ–≤–∞—Ä',
                files: [
                  {
                    file: 'content/products.json',
                    name: 'products_file',
                    label: '–ö–∞—Ç–∞–ª–æ–≥',
                    fields: [
                      { label: '–ù–∞–∑–≤–∞–Ω–∏–µ', name: 'title', widget: 'string' },
                      { label: '–¶–µ–Ω–∞', name: 'price', widget: 'number' },
                      { label: '–û–ø–∏—Å–∞–Ω–∏–µ', name: 'short', widget: 'text', required: false },
                      { label: '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', name: 'image', widget: 'image' },
                    ],
                  },
                ],
              },
            ],
          },
        });
      } else {
        console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ StaticCmsApp...');
        setTimeout(initCMSWhenReady, 200);
      }
    }

    initCMSWhenReady();
  </script>
</body>
</html>
